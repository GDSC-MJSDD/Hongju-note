# 23장 실행 컨텍스트

## 23.1 소스코드의 타입

ECMAScript 사양은 소스코드를 생성 과정과 관리의 내용에 따라 4가지 타입으로 구분하고, 이 소스코드들은 실행 컨텍스트를 생성한다.

1. 전역 코드
   전역 변수와 전역 함수를 전역 객체의 프로퍼티와 메서드로 바인딩하고 참조하기 위해 전역 객체와 연결되어야 한다. 전역 코드라 평가되면 **전역 실행 컨텍스트**가 생성된다.

2. 함수 코드
   함수 코드는 지역변수, 매개변수, arguments 객체를 관리해야하고, 스코프 체인으로 연결해야한다. 따라서 **함수 실행 컨텍스트**가 실행된다.

3. eval 코드
   strict mode(엄격 모드)에서 독자적인 스코프를 생성하고, **eval 실행 컨텍스트**가 실행된다.

4. 모듈 코드
   모듈별로 독립적인 모듈 스코프를 생성한다. **모듈 실행 컨텍스트**가 생성된다.
   <br/>

## 23.2 소스코드의 평가와 실행

소스 코드는 평가 과정을 거치며 '코드를 실행하기 위한 준비'를 한다.
이 과정을 **"소스콛으의 평가"**와 **"소스코드의 실행** 과정으로 나누어 처리한다.
<br/>

- 소스코드 평가
  실행 컨텍스트를 생성 → 선언문(변수, 함수 등) 실행 → 실행 컨텍스트가 관리하는 스코프에 등록
- 소스코드의 실행
  선언문을 제외한 소스코드 실행 == 런타임 시작

## 23.3 실행 컨텍스트의 역할

전역 코드 평가 → 전역 코드 실행 → 함수 코드 평가 → 함수 코드 실행

### 1. 전역 코드 평가

선언문 실행 → 전역 변수, 함수가 전역 스코프에 등록

### 2. 전역 코드 실행

런타임 시작 → 전역 코드 실행 → 전역 변수에 값 할당, 함수 호출 → 함수가 호출 되면 전역 코드의 실행을 일시 중단 하고, 함수 내부로 진입

### 3. 함수 코드 평가

매개변수, 지역 변수 선언문이 실행 → 매개변수, 지역변수가 지역 스코프에 등록
_cf. 이때 argument 객체 생성, this 바인딩 결정_

### 4. 함수 코드 실행

런타임 시작 → 함수 코드 실행 → 매개변수, 지역 변수에 값 할당<br/>

실행 컨텍스트<br/>
= 스코프, 식별자 코드 실행 순서등을 관리하는 것 <br/>
= 소스코드를 실행하는 데 필요한 환경을 제공하고 결과를 실제로 관리하는 영역<br/>
= 식별자를 등록하고 관리하는 스코프와 실행 순서 관리를 구현한 내부 메커니즘<br/>

## 23.4 실행 컨텍스트 스택

- 코드 실행 순서는 **실행 컨텍스트 스택**으로 관리한다.
- 실행 컨텍스트는 스택 자료구조로 관리된다.
- ![EC_stack][https://oopy.lazyrockets.com/api/v2/notion/image?src=https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F0b24eb19-ea4a-47cd-b338-009e1089b82f%2FUntitled.png&blockId=5e7f7b76-392d-4d85-aa3c-bfc23e324b1d]

## 23.5 렉시컬 환경

식별자와 스코프는 실행 컨텍스트의 **렉시컬 환경**으로 관리한다.

- 렉시컬 환경
  식별자와 식별자에 바인딩된 값, 그리고 상위 스코프에 대한 참조를 기록하는 자료구조로 실행 컨텍스트를 구성하는 컴포넌트.
  <br/>

- 키와 값을 갖는 객체 스코프 생성
- 식별자를 키로 등록, 식별자에 바인딩된 값 관리
- 두 개의 컴포넌트로 구성 (환경 레코드 & 외부 렉시컬 환경에 대한 참조)

## 23.6 실행 컨텍스트의 생성과 식별자 검색 과정

💡 전역 객체 생성 → 전역 코드 평가 → 전역 코드 실행 → 함수 코드 평가 → 함수 코드 실행 → 함수 코드 실행 종료 → 전역 코드 실행 종료
<br/>

```javascript
var x = 1;
const y = 2;
function foo(a) {
  var x = 3;
  const y = 4;
  function bar(b) {
    const z = 5;
    console.log(a + b + x + y + z);
  }
  bar(10);
}
foo(20);
```

## 3줄 요약

### 1. 실행 컨텍스트 == 식별자를 등록하고 관리하는 스코프와 실행 순서 관리를 구현한 내부 메커니즘

### 2. 실행 컨텍스트 스택 > 실행 순서 관리

### 3. 렉시컬 환경 > 스코프와 식별자 관리
