# 13장 스코프

## 13.1 스코프란?

스코프는 **식별자가 유효한 범위** 또는 **식별자를 검색할 때 사용하는 규칙**을 의미한다.  
모든 식별자 (변수이름, 함수 이름, 클래스 이름 등)은 자신이 선언된 위치에 의해 다른 코드가 식별자 자신을 참조할 수 있는 유효 범위가 결정된다.  
_cf. 식별자 = '어떤 값을 구별하여 식별해낼 수 있는 고유한 이름'_

- 식별자 결정

  ```javascript
  var x = "global";
  function foo() {
    var x = "local";
    console.log(x);
  }
  foo();

  console.log(x);
  ```

  위 코드에서는 전역변수와 지역변수가 선언되어 있고, 자바스크립트 엔진은 이름이 같은 두 개의 변수 중에서 어떤 변수를 참조해야 할 것인지를 결정하는데, 이를 **식별자 결정**이라고 한다.

- var 키워드로 선언한 변수의 중복 선언
  var로 선언된 변수는 같은 스코프 내에서 중복 선언이 허용된다. 하지만, let, const는같은 스코프 내에서 중복 선언을 허용하지 않는다.
  - var 중복선언
  ```javascript
  function foo() {
    var x = 1;
    var x = 2;
    console.log(x);
  }
  foo(); //x=2
  ```
  - let 중복선언
  ```javascript
  function bar() {
    let x = 1;
    let x = 2;
  }
  bar();
  //SyntaxError: Identifier 'x' has already been declared
  ```

## 13.2 스코프의 종류

| 구분 | 설명                  | 스코프      | 변수      |
| ---- | --------------------- | ----------- | --------- |
| 전역 | 코드의 가장 바깥 영역 | 전역 스코프 | 전역 변수 |
| 지역 | 함수 몸체 내부        | 지역 스코프 | 지역 변수 |

- 전역변수
  전역 변수는 어디서든지 참조할 수 있다.
- 지역 변수
  지역은 **함수 몸체 내부**를 의마한다.  
  지역 변수는 자신의 지역 스코프와 하위 지역 스코프에서 유효하다.  
  함수 밖에서 지역 변수를 참조하면 참조 에러가 발생한다.

## 13.3 스코프 체인

함수는 중첩하여 정의할 수 있다. 따라서, 지역 스코프도 중첩될 수 있다.  
이는, 스코프가 **함수의 중첩에 의해 계층적 구조**를 가진다는 것을 의미한다.  
스포크가 계층적으로 연결된 것을 **스코프 체인**이라고 한다.

변수를 참조할 때, 자바스크립트 엔진은 스코프 체인을 통해 *변수를 참조하는 코드의 스코프에서 시작하여 상위 스코프 방향으로 이동하며 선언된 변수를 검색*한다.  
따라서, 하위 스코프에서는 상위 스코프의 유효 변수를 참조할 수 있지만 반대는 불가하다.

## 13.4 함수 레벨 스코프

지역 == 함수 몸체 내부, 지역은 지역 스코프를 가짐.
따라서, 함수가 아닌 코드블럭(if, for, while, try/catch)은 지역 스코프가 생성되지 않는다.  
var로 선언된 변수는 함수만을 지역 스코프라고 인정하고 이를 **함수 레벨 스코프**라고 한다. (즉, 함수가 아닌 코드블록 내에서 선언된 변수 == 전역변수)  
_cf. 대부분의 프로그래밍 언어는 함수와 모든 코드블록이 지역 스코프를 가진다. (이런 특성을 '블록 레벨 스코프'라고 함.)_

## 13.5 렉시컬 스코프

- 동적 스코프(dynamic scope)
  **함수를 어디서 호출**했는지에 따라 스코프가 결정되기에, 시점에 따라 동적으로 상위 스코프를 결정한다.

- 렉시컬 스코프(lexical scope)
  **함수를 어디서 정의**했는지에 따라 스코프가 결정되기에, 정적 스코프라고 부르며, 대부분의 프로그래밍 언어(js 포함)는 렉시컬 스코프를 따른다.

```javascript
var x = 1;

function foo() {
  var x = 10;
  bar();
}

function bar() {
  console.log(x);
}

foo(); //1
bar(); //1
```

## 3줄 요약

### 1. js는 스코프를 가지고, 이에 따라 변수가 전역변수, 지역변수로 나뉜다.

### 2. 스코프는 계층적 구조를 가지고 이를 스코프 체인이라고 하며, js는 함수 레벨 스코프 + 렉시컬 스코프!

### 3. var로 선언된 변수는 의도치 않은 재할당이 가능하다.
